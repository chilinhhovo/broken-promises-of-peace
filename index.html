<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Broken Promises of Peace</title>
    <link rel="icon" type="image/png" href="website-logo.png">
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes gentlePulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.02); opacity: 1; }
        }
        
        .animate-fade-in {
            animation: fadeIn 1s ease-out forwards;
        }
        
        .animate-gentle-pulse {
            animation: gentlePulse 3s ease-in-out infinite;
        }
        
        body {
            background-color: #1b2230;
            color: #e0e0e0;
            margin: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        #root-flex {
            background-color: #1b2230;
        }
    </style>
</head>
<body>
    <div id="root-flex" class="flex flex-col justify-center items-center min-h-screen w-full">
      <div id="root"></div>
    </div>
    
    <script type="text/babel">
        // Sample conflict data (in case CSV loading fails)
        const SAMPLE_CONFLICTS = [
            {
                id: "1",
                name: "Colombian Civil War",
                location: "Colombia",
                sides: "Government vs FARC",
                intensity: 3,
                startYear: 1964,
                peaceYear: 1975,
                endYear: 2015,
                totalDays: 18627,
                warToPeaceDays: 4018,
                peaceToEndDays: 14609,
                bloodiness: 5
            },
            {
                id: "2",
                name: "Cambodian Civil War",
                location: "Cambodia",
                sides: "Government vs Khmer Rouge",
                intensity: 4,
                startYear: 1967,
                peaceYear: 1975,
                endYear: 1998,
                totalDays: 11323,
                warToPeaceDays: 2832,
                peaceToEndDays: 8491,
                bloodiness: 4
            },
            {
                id: "3",
                name: "Nigerian Civil War",
                location: "Nigeria",
                sides: "Government vs Biafra",
                intensity: 3,
                startYear: 1967,
                peaceYear: 1970,
                endYear: 1970,
                totalDays: 1103,
                warToPeaceDays: 1000,
                peaceToEndDays: 103,
                bloodiness: 3
            }
        ];

        const CreativeWarTimeline = () => {
            const [conflicts, setConflicts] = React.useState([]);
            const [conflictsByContinent, setConflictsByContinent] = React.useState({});
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);
            const [selectedConflict, setSelectedConflict] = React.useState(null);
            const [animateBlood, setAnimateBlood] = React.useState(false);
            const [searchQuery, setSearchQuery] = React.useState("");
            const [openCountries, setOpenCountries] = React.useState({});
            
            React.useEffect(() => {
                const loadData = async () => {
                    try {
                        setLoading(true);
                        
                        // Try to load the CSV file
                        try {
                            const response = await fetch('matched_peace_conflict_episodes.csv');
                            if (!response.ok) {
                                throw new Error("CSV file not found");
                            }
                            
                            const fileContent = await response.text();
                            console.log("CSV content loaded successfully");
                            
                            // Parse CSV
                            const parsedData = Papa.parse(fileContent, {
                                header: true,
                                dynamicTyping: true,
                                skipEmptyLines: true
                            });
                            
                            console.log("CSV parsed successfully, rows:", parsedData.data.length);
                            
                            // Process the data
                            const processedData = parsedData.data
                                .filter(row => {
                                    const hasRequiredFields = row.start_date && row.peace_date && row.end_date && row.conflict_name;
                                    if (!hasRequiredFields) return false;
                                    // Check that peace_date is valid, not 1975-01-01, and falls within the conflict episode
                                    const startDate = new Date(row.start_date);
                                    const peaceDate = new Date(row.peace_date);
                                    const endDate = new Date(row.end_date);
                                    if (isNaN(startDate) || isNaN(peaceDate) || isNaN(endDate)) return false;
                                    if (peaceDate.getTime() === new Date('1975-01-01').getTime()) return false;
                                    if (!(peaceDate >= startDate && peaceDate <= endDate)) return false;
                                    return true;
                                })
                                .map(row => {
                                    try {
                                        const startDate = new Date(row.start_date);
                                        const peaceDate = new Date(row.peace_date);
                                        const endDate = new Date(row.end_date);
                                        const possibleResume = (row.possible_resume === true || row.possible_resume === 'True');
                                        
                                        if (isNaN(startDate) || isNaN(peaceDate) || isNaN(endDate)) {
                                            console.log("Invalid dates in row:", row);
                                            return null;
                                        }
                                        
                                        const totalDays = Math.round((endDate - startDate) / (1000 * 60 * 60 * 24));
                                        const warToPeaceDays = Math.round((peaceDate - startDate) / (1000 * 60 * 60 * 24));
                                        const peaceToEndDays = Math.round((endDate - peaceDate) / (1000 * 60 * 60 * 24));
                                        
                                        if (totalDays <= 0 || warToPeaceDays < 0 || peaceToEndDays < 0) {
                                            console.log("Invalid duration in row:", row);
                                            return null;
                                        }

                                        // Map region codes to continent names
                                        const regionToContinent = {
                                            1: "Europe",
                                            2: "Middle East",
                                            3: "Asia",
                                            4: "Africa",
                                            5: "Americas",
                                            6: "Oceania"
                                        };
                                        
                                        const continent = regionToContinent[row.region] || 'Unknown';
                                        console.log(`Mapped region ${row.region} to continent ${continent}`);
                                        
                                        return {
                                            id: row.paid || Math.random().toString(36).substr(2, 9),
                                            name: row.conflict_name,
                                            location: row.location || 'Unknown',
                                            continent: continent,
                                            sides: `${row.side_a || 'Unknown'} vs ${row.side_b || 'Unknown'}`,
                                            intensity: row.intensity_level || Math.floor(Math.random() * 3) + 1,
                                            startDate: startDate,
                                            peaceDate: peaceDate,
                                            endDate: endDate,
                                            totalDays,
                                            warToPeaceDays,
                                            peaceToEndDays,
                                            startYear: startDate.getFullYear(),
                                            peaceYear: peaceDate.getFullYear(),
                                            endYear: endDate.getFullYear(),
                                            bloodiness: Math.floor(Math.random() * 5) + 1,
                                            possibleResume
                                        };
                                    } catch (e) {
                                        console.error("Error processing row:", e, row);
                                        return null;
                                    }
                                })
                                .filter(Boolean);

                            console.log("Processed data length:", processedData.length);
                            
                            if (processedData.length === 0) {
                                throw new Error("No valid conflicts found in the data");
                            }

                            // Remove duplicate wars globally (not per continent)
                            const uniqueWars = processedData.filter((conflict, index, self) =>
                                index === self.findIndex(c =>
                                    c.name === conflict.name &&
                                    c.startYear === conflict.startYear &&
                                    c.location === conflict.location &&
                                    c.sides === conflict.sides
                                )
                            );

                            // Sort unique wars by duration (longest first)
                            uniqueWars.sort((a, b) => b.totalDays - a.totalDays);

                            // Take up to maxTotalConflicts wars
                            const maxTotalConflicts = 300;
                            const warsToShow = uniqueWars.slice(0, maxTotalConflicts);

                            // Group the unique wars by continent
                            let finalConflictsByContinent;
                            try {
                                finalConflictsByContinent = warsToShow.reduce((acc, conflict) => {
                                    const continent = conflict.continent;
                                    if (!acc[continent]) {
                                        acc[continent] = [];
                                    }
                                    acc[continent].push(conflict);
                                    return acc;
                                }, {});
                            } catch (error) {
                                finalConflictsByContinent = {
                                    "All Conflicts": warsToShow
                                };
                            }
                            setConflicts(warsToShow);
                            setConflictsByContinent(finalConflictsByContinent);
                            setSelectedConflict(warsToShow[0]);
                            
                        } catch (csvError) {
                            console.error("Failed to load CSV:", csvError);
                            setConflicts(SAMPLE_CONFLICTS);
                            // Group sample data by a fake continent for fallback
                            setConflictsByContinent({"Sample Conflicts": SAMPLE_CONFLICTS});
                            setSelectedConflict(SAMPLE_CONFLICTS[0]);
                        }
                        
                        setLoading(false);
                        
                        setTimeout(() => {
                            setAnimateBlood(true);
                        }, 500);
                        
                    } catch (error) {
                        console.error("Error in loadData:", error);
                        setError("Failed to load conflict data");
                        setConflicts(SAMPLE_CONFLICTS);
                        setConflictsByContinent({"Sample Conflicts": SAMPLE_CONFLICTS});
                        setSelectedConflict(SAMPLE_CONFLICTS[0]);
                        setLoading(false);
                        
                        setTimeout(() => {
                            setAnimateBlood(true);
                        }, 500);
                    }
                };
                
                loadData();
            }, []);

            const renderConflictMarkers = (conflict, section, withTooltip, baseY = 90) => {
                const markers = [];
                const numMarkers = section === 'war' 
                    ? Math.min(15, Math.ceil(conflict.warToPeaceDays / 365))
                    : Math.min(10, Math.ceil(conflict.peaceToEndDays / 365));
                const intensitySizes = [20, 24, 28, 32, 36];
                const markerColors = section === 'war' 
                    ? ['#bae6fd', '#7dd3fc', '#38bdf8', '#0ea5e9', '#0369a1']
                    : ['#7f8c8d', '#95a5a6', '#7f8c8d', '#95a5a6', '#7f8c8d'];
                const timelineWidth = 200;
                const startX = 20;
                const rightEdge = timelineWidth - 20;
                const totalDuration = conflict.totalDays;
                const warToPeaceRatio = conflict.warToPeaceDays / totalDuration;
                const peaceToEndRatio = conflict.peaceToEndDays / totalDuration;
                const peaceX = startX + warToPeaceRatio * (timelineWidth - 40);
                let endX = peaceX + Math.max(peaceToEndRatio * (timelineWidth - 40), 30);
                const minSpacing = 30;
                if (endX - peaceX < minSpacing) endX = peaceX + minSpacing;
                if (endX > rightEdge) endX = rightEdge;
                for (let i = 0; i < numMarkers; i++) {
                    const xPos = section === 'war' 
                        ? 20 + (i * 20) 
                        : 20 + (conflict.warToPeaceDays / 365 * 20) + 40 + (i * 15);
                    const size = intensitySizes[Math.max(0, Math.min(intensitySizes.length - 1, (conflict.intensity || 3) - 1))];
                    const colorIdx = Math.min(markerColors.length - 1, Math.floor(i / (numMarkers / markerColors.length)));
                    const color = markerColors[colorIdx];
                    const year = section === 'war'
                        ? conflict.startYear + i
                        : conflict.peaceYear + i;
                    markers.push(
                        <div 
                            key={`${section}-marker-${i}`}
                            className={`absolute transition-all duration-1000 ease-out ${animateBlood ? 'opacity-100' : 'opacity-0'}`}
                            style={{
                                left: `${xPos}px`,
                                top: `${baseY - size/2 + 0.5}px`,
                                zIndex: numMarkers - i
                            }}
                            title={withTooltip ? `Year: ${year}\nIntensity: ${conflict.intensity}` : undefined}
                        >
                            <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
                                <circle 
                                    cx={size/2} 
                                    cy={size/2} 
                                    r={size/2 - 2} 
                                    fill={color}
                                    className={animateBlood ? "animate-gentle-pulse" : ""}
                                />
                            </svg>
                        </div>
                    );
                }
                
                if (section === 'peace') {
                    markers.push(
                        <div 
                            key="peace-marker"
                            className={`absolute transition-all duration-1000 ease-out ${animateBlood ? 'opacity-100' : 'opacity-0'}`}
                            style={{
                                left: `${peaceX}px`,
                                top: `${baseY - 22}px`,
                                zIndex: 50,
                                transitionDelay: '500ms'
                            }}
                        >
                            <svg width="40" height="44" viewBox="0 0 32 44">
                                <path 
                                    d="M16,0 L26,10 L16,20 L6,10 L16,0 Z" 
                                    fill="#e67e22"
                                    className="animate-gentle-pulse"
                                />
                                <text x="16" y="28" textAnchor="middle" fill="white" fontSize="9" fontWeight="bold">
                                    <tspan x="16" dy="0">PEACE</tspan>
                                    <tspan x="16" dy="12">TREATY</tspan>
                                </text>
                            </svg>
                        </div>
                    );
                }
                
                if (section === 'end') {
                    markers.push(
                        <div 
                            key="end-marker"
                            className={`absolute transition-all duration-1000 ease-out ${animateBlood ? 'opacity-100' : 'opacity-0'}`}
                            style={{
                                left: `${endX}px`,
                                top: `${baseY - 22}px`,
                                zIndex: 50,
                                transitionDelay: '1500ms'
                            }}
                        >
                            <svg width="40" height="48" viewBox="0 0 28 44">
                                <path 
                                    d="M14,2 C10,2 7,5 7,9 C7,13 10,16 14,16 C18,16 21,13 21,9 C21,5 18,2 14,2 Z" 
                                    fill={conflict.possibleResume ? '#ef4444' : '#22c55e'}
                                    className="animate-gentle-pulse"
                                />
                                <text x="14" y="28" textAnchor="middle" fill="white" fontSize="9" fontWeight="bold">
                                    <tspan x="14" dy="0">ACTUAL</tspan>
                                    <tspan x="14" dy="12">PEACE</tspan>
                                </text>
                            </svg>
                        </div>
                    );
                }
                
                return markers;
            };

            const renderIntensityRating = (level) => {
                const markers = [];
                for (let i = 0; i < 5; i++) {
                    markers.push(
                        <svg key={i} width="16" height="16" viewBox="0 0 16 16" className={i < level ? "opacity-100" : "opacity-30"}>
                            <circle 
                                cx="8" 
                                cy="8" 
                                r="6" 
                                fill={['#bae6fd', '#7dd3fc', '#38bdf8', '#0ea5e9', '#0369a1'][i]}
                            />
                        </svg>
                    );
                }
                return markers;
            };

            if (loading) {
                return (
                    <div className="flex justify-center items-center h-96 bg-gray-900 text-gray-500">
                        <div className="text-center">
                            <div className="w-24 h-24 mx-auto mb-4 relative">
                                <svg className="absolute animate-bounce" width="100" height="100" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="40" fill="#34495e" />
                                </svg>
                            </div>
                            <p className="text-xl font-bold">Loading Timeline...</p>
                        </div>
                    </div>
                );
            }

            if (error) {
                return <div className="p-4 bg-gray-800 text-white">{error}</div>;
            }

            if (!selectedConflict) {
                return <div className="p-4 bg-gray-900 text-white">No conflict data available</div>;
            }

            if (selectedConflict.name === "India - Pakistan") {
                console.log("India - Pakistan dates:", selectedConflict.startDate, selectedConflict.peaceDate, selectedConflict.endDate);
            }

            return (
                <div className="min-h-screen text-white p-4 flex flex-col items-center">
                    <div className="w-full max-w-4xl mx-auto mt-8 mb-4 p-4 bg-gray-800 bg-opacity-80 rounded-lg text-center">
                        <h1 className="text-4xl font-bold text-gray-100 mb-2">BROKEN PROMISES OF PEACE</h1>
                        <h2 className="text-lg text-gray-300 mb-1">How Peace Treaties Rarely End the Bloodshed</h2>
                        <p className="text-gray-400 text-base">This visualization shows how peace treaties often fail to end violence. Each entry below is a unique conflict episode, not just a country name.</p>
                    </div>
                    <div className="flex flex-col md:flex-row gap-6 w-full max-w-screen-lg mx-auto mr-12">
                        {/* Sidebar: Group by country/region, collapsible */}
                        <div className="md:w-1/4 w-full max-h-[80vh] overflow-y-auto overflow-x-hidden bg-gray-800 bg-opacity-60 rounded-lg p-4 border border-gray-700 relative">
                            {/* Sidebar legend/note */}
                            <div className="sticky top-0 z-10 bg-gray-800 bg-opacity-80 pb-2 mb-2">
                                <input
                                    type="text"
                                    placeholder="Search countries/conflicts..."
                                    value={searchQuery}
                                    onChange={e => setSearchQuery(e.target.value)}
                                    className="w-full px-3 py-2 rounded bg-gray-900 text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-400 mb-2"
                                />
                                <div className="text-xs text-gray-400 text-left mb-1">Each entry is a unique conflict episode. Click a country to expand.</div>
                            </div>
                            {/* Group conflicts by country/region */}
                            {Object.entries(conflictsByContinent || {})
                                .sort(([a], [b]) => a.localeCompare(b))
                                .map(([continent, continentConflicts]) => {
                                    // Group by country/region
                                    const countryGroups = {};
                                    (continentConflicts || []).forEach(conflict => {
                                        const country = (conflict.location || 'Unknown').split(',')[0].trim();
                                        if (!countryGroups[country]) countryGroups[country] = [];
                                        countryGroups[country].push(conflict);
                                    });
                                    return (
                                        <div key={continent} className="mb-6">
                                            <h3 className="text-xl font-bold mb-3 text-gray-300 border-b border-gray-700 pb-2">{continent}</h3>
                                            {Object.entries(countryGroups).sort(([a], [b]) => a.localeCompare(b)).map(([country, conflicts]) => {
                                                // Filter by search
                                                if (
                                                    searchQuery &&
                                                    !country.toLowerCase().includes(searchQuery.toLowerCase()) &&
                                                    !conflicts.some(c => c.sides.toLowerCase().includes(searchQuery.toLowerCase()))
                                                ) return null;
                                                const isOpen = !!openCountries[country];
                                                const toggleOpen = () => setOpenCountries(prev => ({ ...prev, [country]: !prev[country] }));
                                                return (
                                                    <div key={country} className="mb-2">
                                                        <button
                                                            className="w-full text-left font-semibold text-gray-200 bg-gray-700 bg-opacity-60 px-2 py-1 rounded mb-1 hover:bg-gray-600 transition"
                                                            onClick={toggleOpen}
                                                            aria-expanded={isOpen}
                                                        >
                                                            {country} <span className="text-xs text-gray-400">({conflicts.length})</span>
                                                            <span className="float-right">{isOpen ? '▲' : '▼'}</span>
                                                        </button>
                                                        {isOpen && (
                                                            <div className="pl-2 flex flex-col gap-1">
                                                                {conflicts.sort((a, b) => a.sides.localeCompare(b.sides)).map(conflict => {
                                                                    const key = `${(conflict.name || '').trim().toLowerCase()}|${conflict.startYear}|${(conflict.location || '').trim().toLowerCase()}|${(conflict.sides || '').trim().toLowerCase()}`;
                                                                    const selectedKey = selectedConflict ? `${(selectedConflict.name || '').trim().toLowerCase()}|${selectedConflict.startYear}|${(selectedConflict.location || '').trim().toLowerCase()}|${(selectedConflict.sides || '').trim().toLowerCase()}` : '';
                                                                    return (
                                                                        <button
                                                                            key={key}
                                                                            onClick={() => {
                                                                                setSelectedConflict(conflict);
                                                                                setAnimateBlood(false);
                                                                                setTimeout(() => setAnimateBlood(true), 100);
                                                                            }}
                                                                            className={`w-full text-left px-2 py-1 rounded transition-all duration-300 text-xs whitespace-nowrap overflow-hidden text-ellipsis
                                                                                ${key === selectedKey 
                                                                                    ? 'bg-blue-600 text-white shadow scale-105' 
                                                                                    : 'bg-gray-700 text-gray-200 hover:bg-blue-700'}`}
                                                                        >
                                                                            <span className="font-semibold">{conflict.sides}</span>
                                                                            <span className="ml-1 text-gray-400">({conflict.startYear}–{conflict.endYear})</span>
                                                                        </button>
                                                                    );
                                                                })}
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    );
                                })}
                        </div>
                        {/* Main Content: Timeline and Details */}
                        <div className="md:w-2/3 w-full">
                            <div className="bg-black rounded-lg shadow-2xl overflow-hidden mb-8 max-w-4xl mx-auto">
                                <div className="bg-gradient-to-r from-gray-800 to-gray-900 p-4">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <h3 className="text-2xl font-bold">{selectedConflict.name}</h3>
                                            <p className="text-gray-300">{selectedConflict.location}</p>
                                            <p className="text-gray-400 text-sm mt-1">{selectedConflict.sides}</p>
                                        </div>
                                        <div className="text-right">
                                            <div className="flex flex-col items-center mb-4">
                                                <span className="text-xs text-gray-400 mb-2">Intensity or "bloodiness" of the conflict periods</span>
                                                <div className="grid grid-cols-6 gap-1 w-72 mx-auto mb-1">
                                                    {[0,1,2,3,4,5].map(i => (
                                                        <div key={i} className="flex flex-col items-center">
                                                            <svg width="16" height="16" viewBox="0 0 16 16">
                                                                <circle 
                                                                    cx="8" 
                                                                    cy="8" 
                                                                    r="6" 
                                                                    fill={
                                                                        i === 0 ? '#bae6fd' :
                                                                        i === 1 ? '#7dd3fc' :
                                                                        i === 2 ? '#38bdf8' :
                                                                        i === 3 ? '#0ea5e9' :
                                                                        i === 4 ? '#0369a1' :
                                                                        '#95a5a6'
                                                                    }
                                                                    opacity={i < 5 ? (i < selectedConflict.intensity ? 1 : 0.3) : 1}
                                                                />
                                                            </svg>
                                                            <span className="text-xs text-gray-400 mt-1 text-center">
                                                                {i === 3 ? (<><span>Very</span><br/><span>High</span></>) :
                                                                 i === 4 ? (<><span>Extreme</span></>) :
                                                                 i === 5 ? (<><span>No</span><br/><span>Fighting</span></>) :
                                                                 ["Low","Moderate","High"][i]}
                                                            </span>
                                                        </div>
                                                    ))}
                                                </div>
                                                {/* Circle legend below intensity legend */}
                                                <div className="flex flex-row items-center gap-4 mt-2">
                                                    <div className="flex items-center gap-2 bg-gray-900 bg-opacity-80 px-2 py-1 rounded">
                                                        <svg width="18" height="18"><circle cx="9" cy="9" r="8" fill="#38bdf8" /></svg>
                                                        <span className="text-xs text-gray-200">Each circle = 1 year</span>
                                                    </div>
                                                    <div className="flex items-center gap-2 bg-gray-900 bg-opacity-80 px-2 py-1 rounded">
                                                        <svg width="18" height="18"><circle cx="9" cy="9" r="8" fill="#0ea5e9" /></svg>
                                                        <span className="text-xs text-gray-200">Size = intensity</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <p className="text-xl font-bold mt-2">
                                                {Math.round(selectedConflict.totalDays / 365)} <span className="text-sm">years</span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="relative h-56 p-4 bg-gradient-to-b from-gray-800 to-gray-900 overflow-hidden mb-2 rounded-lg">
                                    {/* Timeline label */}
                                    <div className="absolute left-1/2 text-xs text-gray-400" style={{top: '12px', transform: 'translateX(-50%)'}}>
                                        Timeline: from war start to peace treaty to actual end
                                    </div>
                                    {/* Timeline axis */}
                                    <div className="absolute left-5 right-5 h-1 bg-gray-700 top-[90px]"></div>
                                    {/* Start year label (left) */}
                                    <div className="absolute left-5 top-[110px] text-xs text-gray-500">{selectedConflict.startYear}</div>
                                    {/* PEACE TREATY year label, centered below the diamond */}
                                    <div
                                        className="absolute text-xs font-bold"
                                        style={{
                                            left: `${20 + (selectedConflict.warToPeaceDays / 365 * 20)}px`,
                                            top: '110px',
                                            transform: 'translateX(-50%)',
                                            color: '#e67e22'
                                        }}
                                    >
                                        {selectedConflict.peaceYear}
                                    </div>
                                    {/* ACTUAL PEACE year label, centered below the end marker */}
                                    <div
                                        className="absolute text-xs font-bold"
                                        style={{
                                            left: `${20 + (selectedConflict.warToPeaceDays / 365 * 20) + 40 + (Math.min(10, Math.ceil(selectedConflict.peaceToEndDays / 365)) * 15)}px`,
                                            top: '110px',
                                            transform: 'translateX(-50%)',
                                            color: selectedConflict.possibleResume ? '#ef4444' : '#22c55e'
                                        }}
                                    >
                                        {selectedConflict.endYear}
                                    </div>
                                    {/* Render conflict markers with tooltips, all at the same vertical position (centered on the grey line) */}
                                    {renderConflictMarkers(selectedConflict, 'war', true, 90)}
                                    {renderConflictMarkers(selectedConflict, 'peace', true, 90)}
                                    {renderConflictMarkers(selectedConflict, 'end', true, 90)}
                                    {/* Label for post-peace fighting */}
                                    {selectedConflict.peaceToEndDays > 0 && selectedConflict.totalDays > (selectedConflict.warToPeaceDays + selectedConflict.peaceToEndDays) ? (
                                        <div className="absolute left-1/2 w-full text-center" style={{top: '140px', transform: 'translateX(-50%)'}}>
                                            <span className="text-xs font-bold text-red-400 bg-black bg-opacity-60 px-2 py-1 rounded">Fighting or instability continued even after the supposed end of conflict</span>
                                        </div>
                                    ) : null}
                                </div>
                                <div className="bg-gradient-to-r from-gray-800 to-gray-900 w-full px-6 py-3 rounded-md border border-gray-800 mb-6 flex flex-col md:flex-row items-center gap-4">
                                    <div className="flex flex-col md:flex-row items-center mb-2 md:mb-0 gap-4">
                                        <div className="flex items-center">
                                            <svg width="20" height="20" className="mr-2 flex-shrink-0"><circle cx="10" cy="10" r="9" fill="#ef4444" /></svg>
                                            <span className="text-sm font-semibold text-gray-200">Red END: Fighting continued after the peace treaty (conflict not truly over)</span>
                                        </div>
                                    </div>
                                    <div className="flex flex-col md:flex-row items-center mb-2 md:mb-0 gap-4">
                                        <div className="flex items-center">
                                            <svg width="20" height="20" className="mr-2 flex-shrink-0"><circle cx="10" cy="10" r="9" fill="#22c55e" /></svg>
                                            <span className="text-sm font-semibold text-gray-200">Green END: No fighting after the peace treaty (frozen conflict or suspended resolution)</span>
                                        </div>
                                    </div>
                                    <div className="text-sm text-gray-400 mt-2 md:mt-0 md:ml-4">
                                        Circle size reflects the intensity or bloodiness of the conflict period.
                                    </div>
                                </div>
                                <div className="bg-gradient-to-r from-gray-800 to-black p-4">
                                    <div className="grid grid-cols-3 gap-4 text-center">
                                        <div className="bg-gray-900 rounded p-3">
                                            <h4 className="text-gray-400 text-sm">WAR DURATION</h4>
                                            <p className="text-xl font-bold">{Math.round(selectedConflict.warToPeaceDays / 365)} years</p>
                                            <p className="text-xs text-gray-500">{selectedConflict.warToPeaceDays.toLocaleString()} days</p>
                                        </div>
                                        <div className="bg-gray-900 rounded p-3">
                                            <h4 className="text-orange-500 text-sm">PEACE TO END</h4>
                                            <p className="text-xl font-bold">{Math.round(selectedConflict.peaceToEndDays / 365)} years</p>
                                            <p className="text-xs text-gray-500">{selectedConflict.peaceToEndDays.toLocaleString()} days</p>
                                        </div>
                                        <div className="bg-gray-900 rounded p-3">
                                            <h4 className="text-green-500 text-sm">TOTAL CONFLICT</h4>
                                            <p className="text-xl font-bold">{Math.round(selectedConflict.totalDays / 365)} years</p>
                                            <p className="text-xs text-gray-500">{selectedConflict.totalDays.toLocaleString()} days</p>
                                        </div>
                                    </div>
                                    
                                    <div className="mt-4 bg-black bg-opacity-50 p-3 rounded border border-gray-700">
                                        <h4 className="text-gray-400 text-sm font-bold mb-1">THE REALITY OF PEACE</h4>
                                        <p className="text-sm">
                                            {selectedConflict.peaceToEndDays > selectedConflict.warToPeaceDays
                                                ? "This conflict continued longer after peace than during active war, showing how peace treaties often fail to bring true resolution."
                                                : selectedConflict.peaceToEndDays > 365
                                                ? "Despite a peace treaty, violence continued for years, demonstrating the fragility of peace agreements."
                                                : "Even this relatively short post-peace period shows how peace treaties rarely end conflict immediately."}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="bg-black bg-opacity-50 rounded-lg p-6 max-w-4xl mx-auto mb-6">
                                <h3 className="text-xl font-bold mb-4 text-gray-400">THE TRUTH ABOUT PEACE TREATIES</h3>
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div className="bg-gray-900 p-4 rounded">
                                        <h4 className="font-bold mb-2 text-gray-300">The Myth of Peace</h4>
                                        <p className="text-sm">
                                            Peace treaties are often seen as the end of war. In reality, the violence usually continues under new forms.
                                        </p>
                                    </div>
                                    <div className="bg-gray-900 p-4 rounded">
                                        <h4 className="font-bold mb-2 text-gray-300">The Long Shadow of War</h4>
                                        <p className="text-sm">
                                            After peace is declared, conflict can persist through unrest, insurgencies, or political instability.
                                        </p>
                                    </div>
                                    <div className="bg-gray-900 p-4 rounded">
                                        <h4 className="font-bold mb-2 text-gray-300">Failed Transitions</h4>
                                        <p className="text-sm">
                                            The shift from war to peace is rarely clean. Power struggles and unresolved tensions often resurface.
                                        </p>
                                    </div>
                                    <div className="bg-gray-900 p-4 rounded">
                                        <h4 className="font-bold mb-2 text-gray-300">The Cost of False Peace</h4>
                                        <p className="text-sm">
                                            When treaties do not bring real resolution, they prolong suffering. The appearance of peace can block real solutions.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <div className="w-full text-center text-sm text-gray-600 mt-8 mx-auto">
                                Data source: Uppsala Conflict Data Program &nbsp;|&nbsp; Visualization by Chi Vo &nbsp;|&nbsp; <a href="https://github.com/chilinhhovo/project_6">Github</a>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CreativeWarTimeline />);
    </script>
</body>
</html>